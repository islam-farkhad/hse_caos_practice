# SOCKS4 Proxy DIY
Допустим, вы являетесь счастливым обладалетем небольшой корпоративной сети, которой требуется выход в Интернет. Само собой разумеется, вы хотите поставить фильтр трафика для ваших работников, чтобы ничто не отвлекало их от ~~вкалывания на галере~~ добросовестного труда. Конечно, можно возложить задачу фильтрации на роутер, но он оказался недостаточно программируем для ваших изысканных предпочтений в механизмах фильтрации трафика (или может быть он настолько старый, что не поддерживает функционал файервола). В таком случае пришло время попробовать воспользоваться SOCKS протоколом.

## Принцип работы SOCKS4 протокола
SOCKS - протокол взаимодействия клиента и прокси-сервера, управляя правами клиента на доступ к внешним ресурсам и впоследствии передавая клиентский запрос внешнему серверу. Ключевой момент между клиентом и SOCKS-сервером - рукопожатие, по своей сути заявка на подключение к тому или иному ресурсу со стороны клиента. Сервер анализирует этот запрос и в зависимости от выставленных правил отклоняет или разрешает подключение, в дальнейшем работая как посредник, пробрасывающий трафик между клиентом и сервером. Т.е. принцип работы выглядит примерно так:

    Клиент           Прокси           Сервер
      |                |               |
      | 1. Connect ->  |               |
      |                |               |
      |  1. Hello -->  |               |
      |                |               |
      |                | 1. Connect -> |
      |  <-- 1. Hello  |               |
      |                |               |
      |                |               |
      | 2. Data ->     |               |
      |                | 2. Data ->    |
      |                |               |
      |                |               |
      | 2. Fin ->      |               |
      |                | 2. Fin ->     |
      |                |               |
      |                | <- 2. Data    |
      | <- 2. Data     |               |
      |                |               |
      |                | <- 2. Fin     |
      | <- 2. Fin      |               |

## Требуемый функционал
- Реализовать SOCKS4 прокси-сервер на C++.
- Сервер должен работать! Проверить работоспособность можно несколькими способами:
    - Использовать приложение, которое допускает настройку SOCKS4 прокси-сервера (например, Firefox). Поднять вашу программу на localhost-e, вписать localhost:LOCALPORT в конфиг прокси-сервера для приложения и испытать его в полевых условиях.
    - Написать простенький клиент на Java, и запустить его в Java Runtime с параметрами:
    ```
    java –DsocksProxyHost=localhost –DsocksProxyPort=LOCALPORT YourClient
    ```
    - Написать простенький клиент на тех же плюсах, который умеет кидать хендшейки в нужном формате, и протестить работоспособность на нём.
- Обработка соединений со стороны клиентов и серверов должны происходить в рамках одного потока (мультиплексирование).
## Полезная информация
- [SOCKS4](https://www.openssh.com/txt/socks4.protocol) - описание протокола, который необходимо реализовать.
- Для реализации проекта можно использовать [boost::asio](https://www.boost.org/doc/libs/1_86_0/doc/html/boost_asio.html), входящую в библиотеку [boost](https://www.boost.org/). Она сильно облегчит работу с сокетами и мультиплексированием входящих и исходящих соединений. Можно подробнее ознакомиться со следующими элементами библиотеки: 

- boost::asio::buffer;
- boost::asio::ip::tcp;
- boost::asio::async_connect;
- boost::asio::async_read;
- boost::asio::async_write;
- boost::asio::read;
- boost::asio::write;

## На подумать
Какие ещё элементы аутентификации можно добавить при рукопожатии прокси и клиента? Можно ли добавить, например, токены/пароли пользователей в запрос на получение доступа к тому или иному ресурсу? (~~можно ли организовать ютуб по талонам?~~)